<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>document</title>
</head>
<body>
  
    <section class="info">
      <form onsubmit="saveToLocalStorage(event)">
          
              <label >Choose expenseamount:</label>
              <input id="expense" type="number" name="expense" required>
         
            <label >Choose description:</label>
            <input id="description" type="text" name="description" required>
        
            <label >Choose a category:</label>
            <input id="category" type="text" name="category" required>
       
        <button type="submit">Add Expense</button>
      </form>
    </section>
    <ul id="listOfUsers"></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"></script>
    <script>


    function saveToLocalStorage (event){
     event.preventDefault()
    const expense = event.target.expense.value;
    const description = event.target.description.value;
    const category = event.target.category.value;
    const Obj = {
      expense,
      description,
      category
    }
    axios.post("https://crudcrud.com/api/935cfe8adb5b4e329dd00389c0f23585/expense", Obj)
    .then((response)=>{
      showUserOnScreen(response.data)
      console.log(response)
    })
    .catch((err) => {
      document.body.innerHTML= document.body.innerHTML + "<h3>Something went wong</h3>"
    });

    //localStorage.setItem(Obj.description, JSON.stringify(Obj));
    //showUserOnScreen(Obj);
    }
    
   
    window.addEventListener("DOMContentLoaded", () => {
      // const localStorageObj = localStorage;
      // const localstoragekeys = Object.keys(localStorageObj);

      // for(var i=0; i< localstoragekeys.length; i++){
      //   const key = localstoragekeys[i]
      //   const userDetailsString = localStorageObj[key];
      //   const userDetailsObj = JSON.parse(userDetailsString);
      //   showUserOnScreen(userDetailsObj)
      // }
      axios.get("https://crudcrud.com/api/935cfe8adb5b4e329dd00389c0f23585/expense")
      .then((response)=>{
        console.log(response)
        for(var i=0;i<response.data.length;i++){
          showUserOnScreen(response.data[i])
        }
      })
      .catch((err)=>{
        document.body.innerHTML = document.body.innerHTML + "<h3>Something went wrong</h3>"
      })
    })

    function showUserOnScreen (user){
    const parentNode = document.getElementById('listOfUsers');
    const childHTML = `<li id=${user._id}> ${user.expense} - ${user.description} - ${user.category}
      <button onclick=deleteUser('${user._id}')>Delete user</button>
      <button onclick=editUser('${user.expense}','${user.description}','${user.category}','${user._id}')>Edit user</button>
      </li>`
      parentNode.innerHTML = parentNode.innerHTML + childHTML
    }

    function editUser(expense,description,category,userId){
      document.getElementById('expense').value = expense;
      document.getElementById('description').value = description;
      document.getElementById('category').value = category; 
      deleteUser(userId);
    }

    function deleteUser(userId){
      axios.delete(`https://crudcrud.com/api/935cfe8adb5b4e329dd00389c0f23585/expense/${userId}`)
        .then((response) => {
          removeUserFromScreen(userId)
        })
        .catch((err) => {
          console.log(err)
        })
      // localStorage.removeItem(description);
      // removeUserFromScreen(description);
    }

    function removeUserFromScreen(userId){
      const parentNode = document.getElementById('listOfUsers');
      const childNode = document.getElementById(userId);
      parentNode.removeChild(childNode);
    }

    
   
    


    </script>
</body>
</html> 